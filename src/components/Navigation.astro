---
import { getNavItemsForRole, type Role } from "../lib/permissions.ts";

const currentPath = Astro.url.pathname;
const user = Astro.locals.user;

// Filter navigation items based on user role
const navItems = user ? getNavItemsForRole(user.role as Role) : [];
---

<nav class="bg-slate-900 border-b border-slate-800">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16">
      <div class="flex items-center space-x-8">
        <span class="text-xl font-bold text-white"><a href="/">VacationPlanner</a></span>
        <div class="flex space-x-4">
          {
            navItems.map((item) => (
              <a
                href={item.href}
                class:list={[
                  "px-3 py-2 rounded-md text-sm font-medium transition-colors",
                  currentPath === item.href
                    ? "bg-slate-800 text-white"
                    : "text-slate-300 hover:bg-slate-800 hover:text-white",
                ]}
              >
                {item.label}
              </a>
            ))
          }
        </div>
      </div>
      <div class="flex items-center space-x-4">
        {
          user ? (
            <>
              <span class="text-sm text-slate-300">{user.email}</span>
              <button
                id="logout-button"
                class="px-4 py-2 rounded-md text-sm font-medium text-white bg-slate-700 hover:bg-slate-600 transition-colors"
              >
                Wyloguj się
              </button>
            </>
          ) : (
            <a
              href="/login"
              class="px-4 py-2 rounded-md text-sm font-medium text-white bg-slate-700 hover:bg-slate-600 transition-colors"
            >
              Zaloguj się
            </a>
          )
        }
      </div>
    </div>
  </div>
</nav>

<script>
  // Handle logout button click
  const logoutButton = document.getElementById("logout-button");
  if (logoutButton) {
    logoutButton.addEventListener("click", async () => {
      const response = await fetch("/api/auth/logout", {
        method: "POST",
      });

      if (response.ok) {
        // eslint-disable-next-line
        window.location.href = "/login";
      }
    });
  }
</script>
